XAVC和XAVC S主要有以下区别：

1. 格式不同：XAVC编码支持多种格式，XAVC S采用MP4封装
2. 码流不同：XAVC S的码流比XAVC高
3. 清晰度不同：由于码流不同，XAVC S的清晰度比XAVC高



XAVC Intra和XAVC Long GOP有什么区别：

XAVC Intra是一种无损编码格式，每一帧都编码为一个独立的数据包，因此具有更好的图像质量，但是需要更高的码率。它使用与高质量的视频录制和后期制作，例如电影，电视剧等。

XAVC Long GOP是一种有损编码格式，采用长组帧方式编码，即多个帧组成一个数据包，具有较高的压缩比和更低的码率。它使用于需要更长的录制时间、较低的存储需求和更快的数据传输的应用场景，例如新闻、体育赛事等。



# IP化

## 为什么进行IP化？好处

+ 设备连接的简化：多种信号集中在1个带宽很高的接口，系统设计、接线大量简化
+ 可支持远程制作，不再局限于某个区域
+ 稳定性：原生支持主备冗余系统的实现，实现无缝倒换

**ST2110协议簇**，主要定义对IP包的具体格式要求，包括PTP协议（实现主从同步），RTP时间戳（提供时间信息和实现流同步），SDP协议（回话描述协议，告诉接收短如何解释收到的内容）

![](https://www.imaschina.com/uploadfile/20200511/files/5eb91b0103243.png)

## PTP概念

- PTP全称是Precision Time Protocol（精确时钟协议）。
- 协议的主要内容是通过网络，向网上的每个设备发送一个公用参考时钟(Master)，设备内部还含有一个内部设备时钟(Slave)，并且每种信号类型又关联一个媒体时钟。
- PTP实现主从的同步：Slave根据时间戳，计算出偏移量和网络延时，将结果反馈到本地时钟，最终保持同步，这个过程形成一个反馈环，不断循环，最终实现实时的、持续的时钟矫正。

### PTP系统同步流程

Grand Master --> Master --> Slave

1. PTP Grand Master：在系统中使用此协议进行时钟同步的最终时间源，如同步机。普通时钟OC（Ordinary Clock）
2. PTP Master：在单个PTP通信路径中，Master是其他时钟的直接时钟源，此时钟存在于交换机中。边界时钟BC（Boundary Clock）（通过一个端口从上游同步时间，通过其它端口向下游发送时间）、透明时钟TC（Transparent Clock）（通过一个端口从上游接收报文，矫正网络延迟，向下游发送，只对时间进行矫正），BC/TC是全局设定，交换机只能运行在BC或TC模式之一。
3. PTP Slave：一个同步到PTP Master的时钟，如CCU、切换台、IPG等
![image-20230614183440925](https://github.com/gtf2001/ShuZiMeiTiLiLun/assets/108125193/bd851312-ec56-4dd9-85bc-a382bab9948e)


### PTP如何实现主从的同步——时间戳

Timestamp时间戳包含精确的时间信息。

<img src="https://img-blog.csdnimg.cn/a95835e841aa4842ab82d8eecaffc458.png" style="zoom: 80%;" />

从时钟利用t1到t4这个时间，计算出偏移量以及网络延时，将结果反馈到本地时钟，最终保持同步。这一过程形成一个反馈环，不断循环，最终实现实时的、持续的时钟矫正。

Time Offset = ((t~2~-t~1~)-(t~4~-t~3~))/2	(时间偏差)

Delay Time = ((t~2~-t~1~)+(t~4~-t~3~))/2	(延迟时间)

### 判断设备是否同步的标准

+ **ST2059-2**：同一时刻任意两个从设备的时间差在1us（即1000ns）之间时，认为系统实现同步
+ 示波器常用1us作为offset最大绝对值，以判断示波器自身是否锁定上PTP

### IP同步系统实现主备冗余

使用最佳主时钟算法BMCA（Best Master Clock Algorithm）算法，判断优先级，选取最佳主时钟

Announce报文存在一个字段priority，支持用户配置，取值范围是0~255，取值越小优先级越高。

PTP设备在执行动态BMCA时，优先级选择的排序是Priority1>ClockClass>ClockAccuray>OffsetScaledLogVariance>Priority2

## RTP概念

**实时传输协议**（**Real-time Transport Protocol**或简写**RTP**）是一个网络传输协议.
RTP定义了两种报文：RTP报文和RTCP报文，RTP报文用于传送媒体数据（如音频和视频），它由 RTP报头和数据两部分组成，RTP数据部分称为有效载荷(payload)；RTCP报文用于传送控制信息，以实现协议控制功能。RTP报文和RTCP 报文将作为下层协议的数据单元进行传输。如果使用UDP，则RTP报文和RTCP报文分别使用两个相邻的UDP端口，RTP报文使用低端口，RTCP报文使用高端口。如果使用其它的下层协议，RTP报文和RTCP报文可以合并，放在一个数据单元中一起传送，控制信息在前，媒体数据在后。通常，RTP是由应用程序实现的。

## SDP概念

SDP即会话描述协议，在ST2110系统内实现对ST2110 IP流的描述，在SDP文件中的媒体部分，对ST 2110-20、30、40等流的媒体类型参数进行了描述，例如采样率、位深度、画面的宽和高、色彩空间等。

## NMOS概念

NMOS即Networked Media Open Specifications(网络媒体开放规范)，它是高级媒体工作流程协会（AMWA）制定的，用来支持专业视音频媒体行业向“全网络”架构过渡的一个系列协议。NMOS规范目的是提供控制和管理层来补充ST 2110提供的传输层，带来了即插即用的效果和基于AV信号的IP路由管理。

随着NMOS在ST 2110系统中的持续应用，设备NMOS功能能否测量也成为了一个注意点。由于NMOS更偏重实用性的设备管理和配置，因此在检测时需更多依据设备实际操作和实践。

此外，目前阶段NMOS大多只应用了IS-04设备发现、IS-05设备连接管理，所以在检测时也主要侧重这两点

## IP系统如何实现冗余

+ ST2022-7主备冗余系统
+ SDN路由冗余

## IP系统与SDI系统对比

| 比较           | SDI                                                          | IP                                                           |
| -------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 技术           | SDI系统有成熟的设计使用经验；画面质量稳定可靠；信号的延迟和抖动较低；不利于远程制作、远距离传输等新兴需求 | 核心网络设备已经十分成熟；更新迭代快，格式支持面向未来；适合远程制作等应用场景 |
| 系统设计与集成 | 设计、集成经验丰富；线缆连接相对简单，即插即用               | 线缆数量减少，有利于部署；集成经验较少；冗余方式更容易实现，保证系统安全 |
| 开放性         | 容易部署的单向“简单”协议；各家使用各自的控制协议             | 2110标准发展迅速；控制采用NMOS等开放协议                     |
| 发展           | 继续向24G/48G发展；4K系统的一种选择                          | 广电行业第一次和IT行业同步；虚拟化、云转播；未来的发展方向之一 |
| 传输介质       | SD-SDI：270Mbps；HD-SDI：1.5Gbps；3G-SDI：3Gbps；12G-SDI：12Gbps | 10G：3路高清；25G：8路高清；40G：12路高清；100G：32路高清    |

## IP系统同步

1. 频率同步（时间基准）：频率相同、相位差恒定
2. 相位同步（对齐）：相位保持一致

**为什么要保持同步？**

+ 多设备
+ 多信号
+ 实时切换

## IP网络架构

使用Spine-Leaf架构，以交换机为系统核心，有以下特点：

+ 二层扁平化，结构简单
+ 可横向扩展，随意添加交换机
+ 可实现无流量收敛

其中，交换机有以下硬件指标：

+ 端口速率：SFP28（40G）、QSFP28（100G）
+ 端口类型
+ 端口数量
+ 端口可否支持降速
+ 交换容量
+ Break Out能力：能否将单个100/40G拆分成4个25/10G端口

### 中小型系统适用架构——Single Spine

Single Spine架构中只有Spine交换机，没有Leaf交换机，可看作最简的Spine-Leaf架构

#### 小型系统

![image-20230614162956161](https://github.com/gtf2001/ShuZiMeiTiLiLun/assets/108125193/b3904a7f-d537-4527-9954-7832a005be65)

#### 中型系统
![image-20230614163139623](https://github.com/gtf2001/ShuZiMeiTiLiLun/assets/108125193/8d861108-8d59-4903-bacf-dd49ca7169bb)


### 中大型系统适用架构
![image-20230614165648442](https://github.com/gtf2001/ShuZiMeiTiLiLun/assets/108125193/2a85693d-d6c7-425e-aeb2-e6c79c8bc947)


## IP系统的可靠性保证

+ ST 2022-7——数据包级别高精度的无缝倒换，能实现自动选择最优数据包

![image-20230614172939655](https://github.com/gtf2001/ShuZiMeiTiLiLun/assets/108125193/186b6f63-4939-4ae7-a4a2-2506185387ec)

+ 高冗余性对称双网：将设备与两个相同网络连接，达到冗余备份的效果。
+ FEC（Forward Error Correction，前向纠错）是一种通过在网络传输中增加数据的冗余纠错码，使得接收端能够在网络比特流发生误码后利用这些冗余信息直接恢复出丢失的数据的一种方法。FEC编解码会带来一定的延时
+ SDN的多路径保护：保证有多个网络线路可达



## IP测量

**测量内容不同**

由于**传输原理和链路**不同，SDI是对串行数字信号进行直接测量，即测量的是物理层，而IP系统内传输的是IP数据包，想要测量视频信号，必须先测量IP数据包。反应在测量上的区别就是由原来的电平、波形、眼图检测变成了数据包检测。

**IP测量对应的指标为IP状态信息、PTP delay和offset、FCS error和SDP**

**根据五层模型所示，IP测量包括：**

1）物理层检查。主要是物理连接检查，比如光纤，光模块检查；

2）数据链路层检查。主要是MAC地址相关参数，FEC设定等；

3）网络层检查IP地址，组播地址等；

4）传输层检查SDP文件，PTP状态等；

5）应用层检查IP设定是否符合标准，NMOS控制参数等。

## IP系统中组播SSM/ASM

| 单播IP地址 | 一个单播IP地址只能标识一个用户设备，一份使用单播IP地址为目的地址的数据只能被一个用户接受，强行点对多点会重复复制，大量浪费 |
| ---------- | ------------------------------------------------------------ |
| 组播IP地址 | 一个组播IP地址能标识不同网络位置的多个用户设备，一份使用组播IP地址为目的地址的数据能被不同网络位置的多个用户接受。适合点对多点，路由器复制数据包 |
| 广播IP地址 | 一个广播IP地址能标识一个网段的所有用户设备，一份使用广播IP地址为目的地址的数据能够被该网段内的所有用户接受，但是不能跨网段传播。 |

IP组播常见模型分为ASM模型和SSM模型

ASM全称为Any-Source Multicast，译为任意源组播。在ASM模型中，任意发送者都可以成为组播源，向某组播组地址发送信息。接收者加入该组播组后，能够接收到发往该组播组的所有信息。在ASM模型中，接收者无法预先知道组播源的位置，接收者可以在任意时间加入或离开该组播组。
SSM全称为Source-Specific Multicast，译为指定源组播。在现实生活中，用户可能仅对某些源发送的组播信息感兴趣，而不愿接收其它源发送的信息。SSM模型为用户提供了一种能够在客户端指定信源的传输服务。SSM模型和ASM模型的根本区别是接收者已经通过其他手段预先知道了组播源的具体位置。SSM和ASM使用不同的组播地址范围，直接在接收者和组播源之间建立组播转发树。

原文链接：https://blog.csdn.net/network_idiot/article/details/104660219/

### 测量工具

软硬件：IP示波器、Wireshark软件（抓包工具）
